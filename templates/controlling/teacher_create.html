{% load static %}
<!DOCTYPE html>
<html lang="de" class="mks-html">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neuen Lehrer hinzufügen - MKS Management</title>
    
    <!-- MKS Core Styles -->
    <link rel="stylesheet" type="text/css" href="{% static 'css/admin_nav.3.0.3.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'fonts/FontStylesheet/FontStylesheet.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/mobile-enhancements.3.0.3.css' %}">
    <link href="https://use.typekit.net/nvs2bby.css" rel="stylesheet">
    
    <style>
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        .mks-html, .mks-body {
            font-family: 'jaf-bernina-sans-condensed', Arial, sans-serif;
            font-weight: 300;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            color: #1e293b;
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .mks-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 1.5rem;
        }
        
        .mks-nav {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 1rem 1.5rem;
            margin: -1.5rem -1.5rem 2rem -1.5rem;
            border-bottom: 1px solid rgba(226, 232, 240, 0.8);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .mks-nav a {
            color: #D11317;
            text-decoration: none;
            font-size: 0.95rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s ease;
        }
        
        .mks-nav a:hover {
            color: #a00f13;
            transform: translateX(-2px);
        }
        
        .mks-header {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid rgba(226, 232, 240, 0.8);
            border-radius: 12px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            position: relative;
            overflow: hidden;
        }
        
        .mks-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #D11317, #f97316, #eab308);
        }
        
        .mks-title {
            font-size: 2.25rem;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 0.75rem;
            background: linear-gradient(135deg, #0f172a, #475569);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .mks-subtitle {
            color: #64748b;
            font-size: 1.1rem;
            font-weight: 400;
        }
        
        .mks-form {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid rgba(226, 232, 240, 0.8);
            border-radius: 16px;
            padding: 2.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            position: relative;
        }
        
        .mks-form-section {
            margin-bottom: 3rem;
            position: relative;
        }
        
        .mks-form-section:last-of-type {
            margin-bottom: 2rem;
        }
        
        .mks-section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #0f172a;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid #e2e8f0;
            position: relative;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .mks-section-title::before {
            content: '';
            width: 6px;
            height: 6px;
            background: #D11317;
            border-radius: 50%;
            display: block;
        }
        
        .mks-form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .mks-form-row.full-width {
            grid-template-columns: 1fr;
        }
        
        .mks-form-group {
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        .mks-label {
            font-size: 0.95rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .mks-label.required::after {
            content: '*';
            color: #D11317;
            font-weight: 700;
            font-size: 1.1rem;
        }
        
        .mks-input, .mks-select, .mks-textarea {
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            background: #ffffff;
            font-family: inherit;
        }
        
        .mks-input:focus, .mks-select:focus, .mks-textarea:focus {
            outline: none;
            border-color: #D11317;
            box-shadow: 0 0 0 4px rgba(209, 19, 23, 0.1);
            transform: translateY(-1px);
        }
        
        .mks-input:hover, .mks-select:hover, .mks-textarea:hover {
            border-color: #cbd5e1;
        }
        
        .mks-textarea {
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }
        
        .mks-select {
            background: #ffffff url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e") no-repeat right 0.75rem center/1.5em 1.5em;
            cursor: pointer;
            appearance: none;
        }
        
        .mks-checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 0.75rem;
            max-height: 280px;
            overflow-y: auto;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 1.5rem;
            background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
        }
        
        .mks-checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            border-radius: 8px;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .mks-checkbox-item:hover {
            background: rgba(209, 19, 23, 0.05);
            transform: translateX(2px);
        }
        
        .mks-checkbox {
            width: 18px;
            height: 18px;
            accent-color: #D11317;
            cursor: pointer;
        }
        
        .mks-checkbox-label {
            font-size: 0.95rem;
            color: #374151;
            cursor: pointer;
            font-weight: 500;
        }
        
        .mks-help-text {
            font-size: 0.85rem;
            color: #64748b;
            margin-top: 0.5rem;
            font-style: italic;
        }
        
        .mks-btn {
            padding: 1rem 2rem;
            border: 2px solid #e2e8f0;
            background: #ffffff;
            color: #374151;
            text-decoration: none;
            font-size: 0.95rem;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            position: relative;
            overflow: hidden;
        }
        
        .mks-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s;
        }
        
        .mks-btn:hover::before {
            left: 100%;
        }
        
        .mks-btn-primary {
            background: linear-gradient(135deg, #D11317 0%, #a00f13 100%);
            color: #ffffff;
            border-color: #D11317;
            box-shadow: 0 4px 6px -1px rgba(209, 19, 23, 0.3);
        }
        
        .mks-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2);
        }
        
        .mks-btn-primary:hover {
            background: linear-gradient(135deg, #a00f13 0%, #7f0d10 100%);
            box-shadow: 0 10px 15px -3px rgba(209, 19, 23, 0.4);
        }
        
        .mks-form-actions {
            display: flex;
            gap: 1.5rem;
            justify-content: flex-end;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 2px solid #e2e8f0;
        }
        
        .mks-icon {
            width: 18px;
            height: 18px;
            flex-shrink: 0;
        }
        
        .mks-messages {
            margin-bottom: 2rem;
        }
        
        .mks-message {
            padding: 1.25rem 1.5rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            backdrop-filter: blur(10px);
            border: 1px solid;
        }
        
        .mks-message.error {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border-color: #fecaca;
            color: #991b1b;
        }
        
        .mks-message.success {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-color: #bbf7d0;
            color: #166534;
        }
        
        /* Animation for form sections */
        .mks-form-section {
            animation: slideInUp 0.6s ease-out;
            animation-fill-mode: both;
        }
        
        .mks-form-section:nth-child(1) { animation-delay: 0.1s; }
        .mks-form-section:nth-child(2) { animation-delay: 0.2s; }
        .mks-form-section:nth-child(3) { animation-delay: 0.3s; }
        .mks-form-section:nth-child(4) { animation-delay: 0.4s; }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Progress indicator */
        .mks-progress {
            position: fixed;
            top: 0;
            left: 0;
            width: 0%;
            height: 3px;
            background: linear-gradient(90deg, #D11317, #f97316);
            z-index: 1000;
            transition: width 0.3s ease;
        }
        
        @media (max-width: 768px) {
            .mks-container {
                padding: 1rem;
            }
            
            .mks-nav {
                margin: -1rem -1rem 1.5rem -1rem;
                padding: 1rem;
            }
            
            .mks-header {
                padding: 1.5rem;
                text-align: center;
            }
            
            .mks-title {
                font-size: 1.75rem;
            }
            
            .mks-form {
                padding: 1.5rem;
            }
            
            .mks-form-row {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .mks-form-actions {
                flex-direction: column;
                gap: 1rem;
            }
            
            .mks-checkbox-group {
                grid-template-columns: 1fr;
                max-height: 200px;
            }
            
            .mks-section-title {
                font-size: 1.25rem;
            }
        }
        
        /* Custom scrollbar for checkbox groups */
        .mks-checkbox-group::-webkit-scrollbar {
            width: 6px;
        }
        
        .mks-checkbox-group::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }
        
        .mks-checkbox-group::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        
        .mks-checkbox-group::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body class="mks-body">
    <div class="mks-progress" id="progress-bar"></div>
    
    <div class="mks-container">
        <!-- Navigation -->
        {% include 'templates/user_navbar.html' %}
        
        <!-- Breadcrumb -->
        <div class="mks-nav">
            <a href="{% url 'controlling:get_controlling_teachers' %}">
                <svg class="mks-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5"></path>
                    <path d="M12 19l-7-7 7-7"></path>
                </svg>
                Zurück zur Lehrer-Übersicht
            </a>
        </div>1.253zm0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253z"></path>
                            </svg>
                            Fachbereichsleitung
                        </label>
                        <div class="mks-checkbox-group">
                            {% for category in subject_categories %}
                            <div class="mks-checkbox-item">
                                <input type="checkbox" name="subject_coordinators" value="{{ category.id }}" 
                                       id="coordinator_{{ category.id }}" class="mks-checkbox"
                                       {% if category.id|stringformat:"s" in request.POST.getlist:"subject_coordinators" %}checked{% endif %}>
                                <label for="coordinator_{{ category.id }}" class="mks-checkbox-label">
                                    {{ category.name }}
                                </label>
                            </div>
                            {% endfor %}
                        </div>
                        <div class="mks-help-text">Optional - falls diese Person Fachbereichsleitung übernimmt</div>
                    </div>
                </div>
            </div>
            
            <!-- Zusätzliche Informationen -->
            <div class="mks-form-section">
                <h2 class="mks-section-title">
                    <svg class="mks-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                    Zusätzliche Informationen
                </h2>
                
                <div class="mks-form-row full-width">
                    <div class="mks-form-group">
                        <label for="bio" class="mks-label">
                            <svg class="mks-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14,2 14,8 20,8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                <polyline points="10,9 9,9 8,9"></polyline>
                            </svg>
                            Kurze Biografie
                        </label>
                        <textarea name="bio" id="bio" class="mks-input mks-textarea" 
                                  placeholder="Kurze Beschreibung der Ausbildung, Erfahrung oder besonderen Qualifikationen...">{{ request.POST.bio }}</textarea>
                        <div class="mks-help-text">Optional - wird auf der Website und in Broschüren verwendet</div>
                    </div>
                </div>
            </div>
            
            <!-- Form Actions -->
            <div class="mks-form-actions">
                <a href="{% url 'controlling:get_controlling_teachers' %}" class="mks-btn">
                    <svg class="mks-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5"></path>
                        <path d="M12 19l-7-7 7-7"></path>
                    </svg>
                    Abbrechen
                </a>
                <button type="submit" class="mks-btn mks-btn-primary" id="submit-btn">
                    <svg class="mks-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                    </svg>
                    Lehrer erstellen
                </button>
            </div>
        </form>
    </div>
    
    <script>
        // Enhanced form validation and UX improvements
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('teacher-form');
            const progressBar = document.getElementById('progress-bar');
            const requiredFields = form.querySelectorAll('[required]');
            const submitButton = document.getElementById('submit-btn');
            
            // Progress bar animation based on scroll
            function updateProgressBar() {
                const scrollTop = window.pageYOffset;
                const docHeight = document.documentElement.scrollHeight - window.innerHeight;
                const progress = (scrollTop / docHeight) * 100;
                progressBar.style.width = Math.min(progress, 100) + '%';
            }
            
            window.addEventListener('scroll', updateProgressBar);
            
            // Enhanced field validation with visual feedback
            function validateField(field) {
                const isValid = field.checkValidity() && field.value.trim();
                const group = field.closest('.mks-form-group');
                
                // Remove existing validation classes
                field.classList.remove('valid', 'invalid');
                
                if (field.value.trim()) {
                    if (isValid) {
                        field.classList.add('valid');
                        field.style.borderColor = '#22c55e';
                        field.style.boxShadow = '0 0 0 4px rgba(34, 197, 94, 0.1)';
                    } else {
                        field.classList.add('invalid');
                        field.style.borderColor = '#ef4444';
                        field.style.boxShadow = '0 0 0 4px rgba(239, 68, 68, 0.1)';
                    }
                } else if (field.hasAttribute('required')) {
                    field.style.borderColor = '#ef4444';
                    field.style.boxShadow = '0 0 0 4px rgba(239, 68, 68, 0.1)';
                } else {
                    field.style.borderColor = '#e2e8f0';
                    field.style.boxShadow = 'none';
                }
            }
            
            // Real-time validation
            requiredFields.forEach(field => {
                field.addEventListener('blur', () => validateField(field));
                field.addEventListener('input', () => {
                    if (field.classList.contains('invalid') && field.value.trim()) {
                        validateField(field);
                    }
                });
            });
            
            // Special validation for email
            const emailField = document.getElementById('email');
            if (emailField) {
                emailField.addEventListener('blur', function() {
                    if (this.value && !this.value.includes('@')) {
                        this.style.borderColor = '#ef4444';
                        this.style.boxShadow = '0 0 0 4px rgba(239, 68, 68, 0.1)';
                    } else if (this.value) {
                        this.style.borderColor = '#22c55e';
                        this.style.boxShadow = '0 0 0 4px rgba(34, 197, 94, 0.1)';
                    }
                });
            }
            
            // Phone number formatting
            const phoneField = document.getElementById('phone');
            if (phoneField) {
                phoneField.addEventListener('focus', function() {
                    if (!this.value || this.value === '+43 ') {
                        this.value = '+43 ';
                    }
                });
                
                phoneField.addEventListener('input', function() {
                    if (!this.value.startsWith('+43 ')) {
                        this.value = '+43 ' + this.value.replace(/^\+43\s*/, '');
                    }
                });
            }
            
            // Auto-expand textarea with smooth animation
            const bioTextarea = document.getElementById('bio');
            if (bioTextarea) {
                bioTextarea.addEventListener('input', function() {
                    this.style.height = 'auto';
                    this.style.height = Math.max(120, this.scrollHeight) + 'px';
                });
            }
            
            // Form submission with loading state
            form.addEventListener('submit', function(e) {
                // Validate all required fields before submission
                let isFormValid = true;
                requiredFields.forEach(field => {
                    if (!field.value.trim()) {
                        validateField(field);
                        isFormValid = false;
                    }
                });
                
                if (!isFormValid) {
                    e.preventDefault();
                    // Scroll to first invalid field
                    const firstInvalidField = form.querySelector('.invalid, [style*="rgb(239, 68, 68)"]');
                    if (firstInvalidField) {
                        firstInvalidField.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        firstInvalidField.focus();
                    }
                    return;
                }
                
                // Show loading state
                submitButton.disabled = true;
                submitButton.innerHTML = `
                    <svg class="mks-icon animate-spin" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 12a9 9 0 11-6.219-8.56"></path>
                    </svg>
                    Wird erstellt...
                `;
                
                // Add spinning animation
                const spinner = submitButton.querySelector('.animate-spin');
                if (spinner) {
                    spinner.style.animation = 'spin 1s linear infinite';
                }
            });
            
            // Smooth scroll for form sections
            const sections = document.querySelectorAll('.mks-form-section');
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };
            
            const sectionObserver = new IntersectionObserver(function(entries) {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.transform = 'translateY(0px)';
                        entry.target.style.opacity = '1';
                    }
                });
            }, observerOptions);
            
            sections.forEach(section => {
                sectionObserver.observe(section);
            });
            
            // Checkbox group interactions
            const checkboxGroups = document.querySelectorAll('.mks-checkbox-group');
            checkboxGroups.forEach(group => {
                const checkboxes = group.querySelectorAll('.mks-checkbox');
                const items = group.querySelectorAll('.mks-checkbox-item');
                
                items.forEach(item => {
                    item.addEventListener('click', function(e) {
                        if (e.target.type !== 'checkbox') {
                            const checkbox = this.querySelector('.mks-checkbox');
                            checkbox.checked = !checkbox.checked;
                        }
                    });
                });
            });
            
            // Add floating labels effect
            const inputs = document.querySelectorAll('.mks-input, .mks-select, .mks-textarea');
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    this.parentElement.classList.add('focused');
                });
                
                input.addEventListener('blur', function() {
                    if (!this.value) {
                        this.parentElement.classList.remove('focused');
                    }
                });
                
                // Initialize state
                if (input.value) {
                    input.parentElement.classList.add('focused');
                }
            });
        });
        
        // Add CSS for animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
            }
            
            .mks-form-group.focused .mks-label {
                color: #D11317;
                transform: translateY(-2px);
            }
            
            .mks-input.valid, .mks-select.valid, .mks-textarea.valid {
                border-color: #22c55e !important;
                box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.1) !important;
            }
            
            .mks-input.invalid, .mks-select.invalid, .mks-textarea.invalid {
                border-color: #ef4444 !important;
                box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.1) !important;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>