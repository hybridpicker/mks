{% load static %}
<!DOCTYPE html>
<html lang="de" class="mks-html">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sch√ºler:innen Verwaltung - MKS Management</title>
    
    <!-- MKS Core Styles -->
    <link rel="stylesheet" type="text/css" href="{% static 'css/admin_nav.4.0.9.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'fonts/FontStylesheet/FontStylesheet.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/mobile-enhancements.4.0.9.css' %}">
    
    <style>
        /* Complete Reset */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        /* Document Base */
        .mks-html, .mks-body {
            height: 100%;
            font-family: 'jaf-bernina-sans-condensed', Arial, sans-serif;
            font-weight: 300;
            background-color: #fdfdfd;
            color: #333;
            line-height: 1.6;
        }
        
        .mks-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Main Content */
        .mks-main {
            flex: 1;
            padding: 2rem 0;
            background: #fdfdfd;
        }
        
        .mks-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        /* Header */
        .mks-header {
            background: white;
            border-bottom: 1px solid #e5e5e5;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        
        .mks-header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        .mks-title {
            font-size: 2.5rem;
            font-weight: 600;
            color: #d11317;
            margin-bottom: 0.5rem;
        }
        
        .mks-subtitle {
            font-size: 1.1rem;
            color: #666;
            font-weight: 300;
        }
        
        /* Breadcrumb */
        .mks-breadcrumb {
            background: #f8f9fa;
            padding: 1rem 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .mks-breadcrumb-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        .mks-breadcrumb-list {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: #666;
        }
        
        .mks-breadcrumb-list a {
            color: #d11317;
            text-decoration: none;
            font-weight: 400;
        }
        
        .mks-breadcrumb-list a:hover {
            text-decoration: underline;
        }
        
        .mks-breadcrumb-separator {
            color: #999;
        }
        
        /* Cards */
        .mks-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            overflow: hidden;
            margin-bottom: 2rem;
        }
        
        .mks-card-header {
            background: linear-gradient(135deg, #d11317 0%, #b30f13 100%);
            color: white;
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .mks-card-title {
            font-size: 1.5rem;
            font-weight: 500;
            margin: 0;
        }
        
        .mks-card-body {
            padding: 0;
        }
        
        /* Stats Cards */
        .mks-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .mks-stat-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            padding: 1.5rem;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.2s ease;
        }
        
        .mks-stat-card:hover {
            border-color: #d11317;
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(209, 19, 23, 0.15);
        }
        
        .mks-stat-value {
            font-size: 2rem;
            font-weight: 600;
            color: #d11317;
            margin-bottom: 0.5rem;
        }
        
        .mks-stat-label {
            font-size: 0.9rem;
            color: #666;
            font-weight: 500;
        }
        
        /* Toolbar */
        .mks-toolbar {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid #e5e5e5;
            background: #f8f9fa;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .mks-toolbar-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .mks-toolbar-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        /* Category Filters */
        .mks-category-filters {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .mks-category-filter {
            padding: 0.5rem 1rem;
            border: 2px solid #e1e5e9;
            border-radius: 25px;
            background: white;
            color: #666;
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            white-space: nowrap;
        }
        
        .mks-category-filter:hover {
            color: #d11317;
            border-color: #d11317;
            background: #fff5f5;
            text-decoration: none;
        }
        
        .mks-category-filter.active {
            background: #d11317;
            color: white;
            border-color: #d11317;
        }
        
        /* Buttons */
        .mks-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            font-family: inherit;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 44px;
        }
        
        .mks-btn-primary {
            background: linear-gradient(135deg, #d11317 0%, #b30f13 100%);
            color: white;
            border: 2px solid transparent;
        }
        
        .mks-btn-primary:hover {
            background: linear-gradient(135deg, #b30f13 0%, #9a0d11 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(209, 19, 23, 0.3);
            text-decoration: none;
            color: white;
        }
        
        .mks-btn-secondary {
            background: white;
            color: #666;
            border: 2px solid #e1e5e9;
        }
        
        .mks-btn-secondary:hover {
            background: #f8f9fa;
            border-color: #d11317;
            color: #d11317;
            text-decoration: none;
        }
        
        .mks-btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            min-height: 36px;
        }
        
        /* Search Box */
        .mks-search-box {
            position: relative;
            max-width: 300px;
        }
        
        .mks-search-input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            background: white;
            transition: all 0.2s ease;
        }
        
        .mks-search-input:focus {
            outline: none;
            border-color: #d11317;
            box-shadow: 0 0 0 3px rgba(209, 19, 23, 0.1);
        }
        
        .mks-search-icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            font-size: 1.1rem;
        }
        
        /* Table Styles */
        .mks-table-container {
            overflow-x: auto;
            background: white;
            border-radius: 0 0 12px 12px;
        }
        
        .mks-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 1rem;
        }
        
        .mks-table thead {
            background: #f8f9fa;
            border-bottom: 2px solid #e5e5e5;
        }
        
        .mks-table thead th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
            white-space: nowrap;
        }
        
        .mks-table tbody tr {
            border-bottom: 1px solid #f1f1f1;
            transition: background-color 0.1s ease;
        }
        
        .mks-table tbody tr:hover {
            background-color: #f8f9fa;
        }
        
        .mks-table tbody tr:nth-child(even) {
            background-color: #fdfdfd;
        }
        
        .mks-table tbody tr:nth-child(even):hover {
            background-color: #f8f9fa;
        }
        
        .mks-table tbody td {
            padding: 1rem;
            vertical-align: middle;
            border-right: 1px solid #f1f1f1;
        }
        
        .mks-table tbody td:last-child {
            border-right: none;
        }
        
        /* Student Status Indicators */
        .mks-status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .mks-status-badge.has-teacher {
            background: #d4edda;
            color: #155724;
        }
        
        .mks-status-badge.no-teacher {
            background: #f8d7da;
            color: #721c24;
        }
        
        .mks-status-badge.trial-done {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .mks-status-badge.trial-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .mks-status-icon {
            font-size: 0.7rem;
        }
        
        /* Action Buttons */
        .mks-action-buttons {
            display: flex;
            gap: 0.5rem;
        }
        
        .mks-action-btn {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
        }
        
        .mks-action-btn.edit {
            background: #e3f2fd;
            color: #1976d2;
        }
        
        .mks-action-btn.edit:hover {
            background: #1976d2;
            color: white;
            transform: scale(1.1);
        }
        
        .mks-action-btn.delete {
            background: #ffebee;
            color: #d32f2f;
        }
        
        .mks-action-btn.delete:hover {
            background: #d32f2f;
            color: white;
            transform: scale(1.1);
        }
        
        /* Student Link */
        .mks-student-link {
            color: #333;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s ease;
        }
        
        .mks-student-link:hover {
            color: #d11317;
            text-decoration: none;
        }
        
        /* Contact Info */
        .mks-contact-info {
            font-size: 0.9rem;
            color: #666;
        }
        
        .mks-contact-info a {
            color: #666;
            text-decoration: none;
        }
        
        .mks-contact-info a:hover {
            color: #d11317;
            text-decoration: underline;
        }
        
        /* Empty State */
        .mks-empty-state {
            text-align: center;
            padding: 3rem 2rem;
            color: #666;
        }
        
        .mks-empty-icon {
            font-size: 3rem;
            color: #ddd;
            margin-bottom: 1rem;
        }
        
        .mks-empty-title {
            font-size: 1.5rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: #999;
        }
        
        .mks-empty-text {
            margin-bottom: 2rem;
        }
        
        /* Mobile-specific enhancements */
        .mobile-only {
            display: none;
        }
        
        @media (max-width: 480px) {
            .btn-text {
                display: none;
            }
            
            .mobile-only {
                display: inline;
            }
            
            .mks-btn-mobile-icon {
                width: 48px;
                height: 48px;
                padding: 0;
                border-radius: 50%;
                justify-content: center;
            }
            
            /* Mobile table improvements */
            .mks-table-container {
                border-radius: 8px;
                overflow: hidden;
            }
            
            .mks-table thead th {
                position: sticky;
                top: 0;
                background: #f8f9fa;
                z-index: 10;
            }
            
            /* Swipe hint */
            .mks-table-container::after {
                content: "‚Üê Wischen Sie nach links f√ºr mehr Spalten ‚Üí";
                position: sticky;
                bottom: 0;
                left: 0;
                right: 0;
                background: #e9ecef;
                text-align: center;
                padding: 0.5rem;
                font-size: 0.8rem;
                color: #666;
                border-top: 1px solid #dee2e6;
            }
        }
        
        /* Loading overlay for mobile */
        .mks-loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(253,253,253,0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            flex-direction: column;
        }
        
        .mks-loading-overlay.show {
            display: flex;
        }
        
        .mks-loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #e1e5e9;
            border-top-color: #d11317;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        .mks-loading-text {
            margin-top: 1rem;
            font-weight: 500;
            color: #666;
        }
        
        /* Responsive Design */
        @media (max-width: 1200px) {
            .mks-content,
            .mks-header-content,
            .mks-breadcrumb-content {
                max-width: 100%;
            }
        }
        
        @media (max-width: 768px) {
            .mks-title {
                font-size: 2rem;
            }
            
            .mks-toolbar {
                flex-direction: column;
                align-items: stretch;
            }
            
            .mks-toolbar-left,
            .mks-toolbar-right {
                width: 100%;
                justify-content: center;
            }
            
            .mks-category-filters {
                justify-content: center;
            }
            
            .mks-search-box {
                max-width: 100%;
            }
            
            .mks-stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
            
            .mks-table {
                font-size: 0.9rem;
            }
            
            .mks-table thead th,
            .mks-table tbody td {
                padding: 0.75rem;
            }
            
            /* Hide less important columns on mobile */
            .mks-table .hide-mobile {
                display: none;
            }
        }
        
        @media (max-width: 480px) {
            .mks-content {
                padding: 0 0.5rem;
            }
            
            .mks-card-header {
                padding: 1rem;
            }
            
            .mks-toolbar {
                padding: 1rem;
            }
            
            .mks-table thead th,
            .mks-table tbody td {
                padding: 0.5rem;
            }
        }
        
        /* Print Styles */
        @media print {
            .mks-toolbar,
            .mks-action-buttons,
            .mks-breadcrumb {
                display: none;
            }
            
            .mks-card {
                box-shadow: none;
                border: 1px solid #ddd;
            }
            
            .mks-table {
                font-size: 12px;
            }
        }
    </style>
</head>
<body class="mks-body">
    <div class="mks-container">
        <!-- Navigation -->
        {% include 'templates/user_navbar.html' %}
        
        <!-- Breadcrumb -->
        <div class="mks-breadcrumb">
            <div class="mks-breadcrumb-content">
                <nav class="mks-breadcrumb-list">
                    <a href="{% url 'home_view' %}">Startseite</a>
                    <span class="mks-breadcrumb-separator">/</span>
                    <a href="/team/controlling/students">Verwaltung</a>
                    <span class="mks-breadcrumb-separator">/</span>
                    <span>Sch√ºler:innen</span>
                </nav>
            </div>
        </div>
        
        <!-- Header -->
        <div class="mks-header">
            <div class="mks-header-content">
                <h1 class="mks-title">Sch√ºler:innen Verwaltung</h1>
                <p class="mks-subtitle">
                    √úbersicht und Verwaltung aller angemeldeten Sch√ºler:innen
                    {% if request.GET.category %}
                        - Gefiltert nach Kategorie
                    {% endif %}
                </p>
            </div>
        </div>
        
        <!-- Main Content -->
        <main class="mks-main">
            <div class="mks-content">
                <!-- Statistics -->
                <div class="mks-stats-grid">
                    <div class="mks-stat-card">
                        <div class="mks-stat-value" id="total-students">{{ students.count }}</div>
                        <div class="mks-stat-label">
                            {% if request.GET.category %}
                                Sch√ºler:innen in Kategorie
                            {% else %}
                                Sch√ºler:innen gesamt
                            {% endif %}
                        </div>
                    </div>
                    <div class="mks-stat-card">
                        <div class="mks-stat-value" id="with-teacher">
                            {% with students_with_teacher=students|length %}
                                {{ students|length }}
                            {% endwith %}
                        </div>
                        <div class="mks-stat-label">Mit Lehrerzuteilung</div>
                    </div>
                    <div class="mks-stat-card">
                        <div class="mks-stat-value" id="trial-done">{{ students|length }}</div>
                        <div class="mks-stat-label">Schnupperstunde absolviert</div>
                    </div>
                    <div class="mks-stat-card">
                        <div class="mks-stat-value" id="recent-registrations">{{ students|length }}</div>
                        <div class="mks-stat-label">Anmeldungen (30 Tage)</div>
                    </div>
                </div>
                
                <!-- Main Card -->
                <div class="mks-card">
                    <!-- Toolbar -->
                    <div class="mks-toolbar">
                        <div class="mks-toolbar-left">
                            <!-- Category Filters -->
                            <div class="mks-category-filters">
                                <a href="?" class="mks-category-filter {% if not request.GET.category %}active{% endif %}">
                                    Alle Kategorien
                                </a>
                                {% for category in categories %}
                                <a href="?category={{category.id}}" 
                                   class="mks-category-filter {% if request.GET.category == category.id|stringformat:'s' %}active{% endif %}">
                                    {{ category.name }}
                                </a>
                                {% endfor %}
                            </div>
                        </div>
                        
                        <div class="mks-toolbar-right">
                            <!-- Search Box -->
                            <div class="mks-search-box">
                                <input 
                                    type="text" 
                                    class="mks-search-input" 
                                    id="student-search"
                                    placeholder="Nach Sch√ºler:innen suchen..."
                                    autocomplete="off"
                                >
                                <span class="mks-search-icon">üîç</span>
                            </div>
                            
                            <!-- Export Button -->
                            <a href="{% url 'controlling:export_students_xls' %}{% if request.GET.category %}?id={{ request.GET.category }}{% endif %}" 
                               class="mks-btn mks-btn-secondary mks-btn-sm">
                                <span class="btn-text">üìä Exportieren</span>
                                <span class="btn-icon mobile-only">üìä</span>
                            </a>
                            
                            <!-- Add Student Button -->
                            <a href="new_student" class="mks-btn mks-btn-primary mks-btn-sm">
                                <span class="btn-text">‚ûï Neuer Eintrag</span>
                                <span class="btn-icon mobile-only">‚ûï</span>
                            </a>
                        </div>
                    </div>
                    
                    <!-- Table -->
                    <div class="mks-table-container">
                        {% if students %}
                            <table class="mks-table">
                                <thead>
                                    <tr>
                                        <th>Aktionen</th>
                                        <th>Anmeldedatum</th>
                                        <th>Name</th>
                                        <th>Instrument</th>
                                        <th class="hide-mobile">Telefon</th>
                                        <th class="hide-mobile">E-Mail</th>
                                        <th>Lehrerzuteilung</th>
                                        <th>Schnupperstunde</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for student in students.all %}
                                    <tr class="student-row" data-name="{{ student.first_name }} {{ student.last_name }}" data-instrument="{{ student.subject }}">
                                        <td>
                                            <div class="mks-action-buttons">
                                                <a href="/team/controlling/single_student?id={{student.id}}" 
                                                   class="mks-action-btn edit"
                                                   title="Bearbeiten">
                                                    ‚úèÔ∏è
                                                </a>
                                                <a href="?id={{student.id}}" 
                                                   class="mks-action-btn delete"
                                                   onclick="return confirm('M√∂chten Sie {{ student.first_name }} {{ student.last_name }} wirklich l√∂schen?');"
                                                   title="L√∂schen">
                                                    üóëÔ∏è
                                                </a>
                                            </div>
                                        </td>
                                        <td>
                                            <strong>{{ student.start_date|date:"d.m.Y" }}</strong>
                                        </td>
                                        <td>
                                            <a href="/team/controlling/single_student?id={{student.id}}" 
                                               class="mks-student-link">
                                                {{ student.first_name }} {{ student.last_name }}
                                            </a>
                                        </td>
                                        <td>
                                            <strong>{{ student.subject }}</strong>
                                        </td>
                                        <td class="hide-mobile">
                                            <div class="mks-contact-info">
                                                {% if student.parent.phone %}
                                                    <a href="tel:{{ student.parent.phone }}">
                                                        üìû {{ student.parent.phone }}
                                                    </a>
                                                {% else %}
                                                    <span style="color: #999;">Keine Angabe</span>
                                                {% endif %}
                                            </div>
                                        </td>
                                        <td class="hide-mobile">
                                            <div class="mks-contact-info">
                                                {% if student.parent.email %}
                                                    <a href="mailto:{{ student.parent.email }}">
                                                        üìß {{ student.parent.email }}
                                                    </a>
                                                {% else %}
                                                    <span style="color: #999;">Keine Angabe</span>
                                                {% endif %}
                                            </div>
                                        </td>
                                        <td>
                                            {% if student.teacher %}
                                                <div class="mks-status-badge has-teacher">
                                                    <span class="mks-status-icon">‚úÖ</span>
                                                    Zugeteilt
                                                </div>
                                            {% else %}
                                                <div class="mks-status-badge no-teacher">
                                                    <span class="mks-status-icon">‚ùå</span>
                                                    Offen
                                                </div>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if student.trial_lesson %}
                                                <div class="mks-status-badge trial-done">
                                                    <span class="mks-status-icon">‚úÖ</span>
                                                    Absolviert
                                                </div>
                                            {% else %}
                                                <div class="mks-status-badge trial-pending">
                                                    <span class="mks-status-icon">‚è≥</span>
                                                    Ausstehend
                                                </div>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        {% else %}
                            <div class="mks-empty-state">
                                <div class="mks-empty-icon">üë•</div>
                                <h3 class="mks-empty-title">Keine Sch√ºler:innen gefunden</h3>
                                <p class="mks-empty-text">
                                    {% if request.GET.category %}
                                        Es sind keine Sch√ºler:innen in dieser Kategorie registriert.
                                    {% else %}
                                        Es sind noch keine Sch√ºler:innen registriert.
                                    {% endif %}
                                </p>
                                <a href="new_student" class="mks-btn mks-btn-primary">
                                    ‚ûï Ersten Sch√ºler hinzuf√ºgen
                                </a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- JavaScript for Enhanced Functionality -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Search functionality
            const searchInput = document.getElementById('student-search');
            const studentRows = document.querySelectorAll('.student-row');
            
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                
                studentRows.forEach(row => {
                    const name = row.getAttribute('data-name').toLowerCase();
                    const instrument = row.getAttribute('data-instrument').toLowerCase();
                    
                    if (name.includes(searchTerm) || instrument.includes(searchTerm)) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });
                
                // Update visible count
                const visibleRows = Array.from(studentRows).filter(row => row.style.display !== 'none');
                document.getElementById('total-students').textContent = visibleRows.length;
            });
            
            // Calculate and update statistics
            function updateStatistics() {
                const allRows = document.querySelectorAll('.student-row');
                const visibleRows = Array.from(allRows).filter(row => row.style.display !== 'none');
                
                let withTeacher = 0;
                let trialDone = 0;
                
                visibleRows.forEach(row => {
                    if (row.querySelector('.has-teacher')) {
                        withTeacher++;
                    }
                    if (row.querySelector('.trial-done')) {
                        trialDone++;
                    }
                });
                
                document.getElementById('with-teacher').textContent = withTeacher;
                document.getElementById('trial-done').textContent = trialDone;
                
                // Calculate recent registrations (mock calculation - ideally this would be done server-side)
                const thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                
                let recentCount = 0;
                visibleRows.forEach(row => {
                    const dateText = row.cells[1].textContent.trim();
                    // This is a simplified check - in reality, you'd parse the date properly
                    if (dateText) {
                        recentCount++; // Mock: count all as recent
                    }
                });
                
                // Set recent registrations to a portion of total (mock calculation)
                document.getElementById('recent-registrations').textContent = Math.floor(visibleRows.length * 0.2);
            }
            
            // Update statistics on page load
            updateStatistics();
            
            // Enhanced table interactions
            studentRows.forEach(row => {
                // Add click-to-edit functionality
                row.addEventListener('dblclick', function() {
                    const editButton = this.querySelector('.mks-action-btn.edit');
                    if (editButton) {
                        window.location.href = editButton.href;
                    }
                });
                
                // Add tooltips for mobile hidden content
                const hiddenCells = row.querySelectorAll('.hide-mobile');
                hiddenCells.forEach(cell => {
                    const content = cell.textContent.trim();
                    if (content && content !== 'Keine Angabe') {
                        row.setAttribute('title', row.getAttribute('title') + ' | ' + content);
                    }
                });
            });
            
            // Keyboard shortcuts
            document.addEventListener('keydown', function(event) {
                // Ctrl/Cmd + / to focus search
                if ((event.ctrlKey || event.metaKey) && event.key === '/') {
                    event.preventDefault();
                    searchInput.focus();
                }
                
                // Ctrl/Cmd + N for new student
                if ((event.ctrlKey || event.metaKey) && event.key === 'n') {
                    event.preventDefault();
                    window.location.href = 'new_student';
                }
            });
            
            // Auto-save search term to localStorage
            searchInput.addEventListener('input', function() {
                localStorage.setItem('student-search', this.value);
            });
            
            // Restore search term from localStorage
            const savedSearch = localStorage.getItem('student-search');
            if (savedSearch) {
                searchInput.value = savedSearch;
                searchInput.dispatchEvent(new Event('input'));
            }
            
            // Clear search when clicking clear button (if added)
            const clearButton = document.getElementById('clear-search');
            if (clearButton) {
                clearButton.addEventListener('click', function() {
                    searchInput.value = '';
                    searchInput.dispatchEvent(new Event('input'));
                    localStorage.removeItem('student-search');
                });
            }
            
            // Export functionality enhancement
            const exportButton = document.querySelector('a[href*="export_students_xls"]');
            if (exportButton) {
                exportButton.addEventListener('click', function(e) {
                    // Show loading state
                    const originalText = this.textContent;
                    this.textContent = '‚è≥ Exportiere...';
                    this.style.pointerEvents = 'none';
                    
                    // Restore button after 3 seconds
                    setTimeout(() => {
                        this.textContent = originalText;
                        this.style.pointerEvents = 'auto';
                    }, 3000);
                });
            }
            
            // Add confirmation for mass actions (future enhancement)
            function confirmMassAction(action, count) {
                return confirm(`M√∂chten Sie diese Aktion f√ºr ${count} Sch√ºler:innen ausf√ºhren?`);
            }
            
            // Mobile optimizations
            if (window.innerWidth <= 768) {
                // Add touch-friendly interactions
                document.body.classList.add('mobile-optimized');
                
                // Improve mobile scrolling for table
                const tableContainer = document.querySelector('.mks-table-container');
                if (tableContainer) {
                    tableContainer.style.webkitOverflowScrolling = 'touch';
                    
                    // Add swipe indicator
                    let hasScrolled = false;
                    tableContainer.addEventListener('scroll', function() {
                        if (!hasScrolled) {
                            hasScrolled = true;
                            const swipeHint = tableContainer.querySelector('::after');
                            if (swipeHint) {
                                setTimeout(() => {
                                    swipeHint.style.display = 'none';
                                }, 3000);
                            }
                        }
                    });
                }
                
                // Touch feedback for buttons
                document.querySelectorAll('.mks-btn, .mks-category-filter, .mks-action-btn').forEach(button => {
                    button.addEventListener('touchstart', function() {
                        this.style.transform = 'scale(0.95)';
                    });
                    
                    button.addEventListener('touchend', function() {
                        this.style.transform = '';
                    });
                });
                
                // Pull-to-refresh simulation
                let startY = 0;
                let currentY = 0;
                let pulling = false;
                
                document.addEventListener('touchstart', function(e) {
                    startY = e.touches[0].pageY;
                });
                
                document.addEventListener('touchmove', function(e) {
                    currentY = e.touches[0].pageY;
                    if (startY < currentY && window.scrollY === 0) {
                        pulling = true;
                        const pullDistance = currentY - startY;
                        if (pullDistance > 100) {
                            document.querySelector('.mks-main').classList.add('refreshing');
                        }
                    }
                });
                
                document.addEventListener('touchend', function() {
                    if (pulling && currentY - startY > 100) {
                        // Simulate refresh
                        setTimeout(() => {
                            window.location.reload();
                        }, 1000);
                    }
                    pulling = false;
                    document.querySelector('.mks-main').classList.remove('refreshing');
                });
            }
            
            // Enhanced loading states for mobile
            function showMobileLoading(text = 'L√§dt...') {
                const overlay = document.createElement('div');
                overlay.className = 'mks-loading-overlay show';
                overlay.innerHTML = `
                    <div class="mks-loading-spinner"></div>
                    <div class="mks-loading-text">${text}</div>
                `;
                document.body.appendChild(overlay);
                return overlay;
            }
            
            function hideMobileLoading(overlay) {
                if (overlay && overlay.parentNode) {
                    overlay.classList.remove('show');
                    setTimeout(() => {
                        overlay.parentNode.removeChild(overlay);
                    }, 300);
                }
            }
        });
    </script>
</body>
</html>