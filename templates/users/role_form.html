{% extends "templates/base.html" %}
{% load static %}

{% block tab_id %}id="role_form_tab"{% endblock %}

{% block extra_head %}
<meta name="robots" content="noindex">
<style>
.form-container { padding: 2rem 0; background: #fdfdfd; min-height: 80vh; }
.form-hero { background: #f8f9fa; border-bottom: 3px solid #D11317; padding: 2rem; text-align: center; }
.form-title { font-family: "jaf-bernina-sans-condensed", sans-serif; font-size: 2.2rem; font-weight: 800; color: #D11317; margin-bottom: 0.5rem; }
.form-subtitle { font-family: "jaf-bernina-sans-condensed", sans-serif; font-size: 1rem; color: #666; font-weight: 500; }
.form-card { background: white; border: 1px solid #e0e0e0; border-radius: 12px; padding: 2rem; margin: 2rem auto; max-width: 800px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
.form-group { margin-bottom: 1.5rem; }
.form-label { display: block; font-weight: 600; color: #333; margin-bottom: 0.5rem; font-size: 0.95rem; }
.form-control { width: 100%; padding: 0.8rem; border: 1px solid #ddd; border-radius: 6px; font-size: 0.95rem; transition: border-color 0.3s ease; }
.form-control:focus { outline: none; border-color: #D11317; box-shadow: 0 0 0 2px rgba(209, 19, 23, 0.1); }
.form-select { width: 100%; padding: 0.8rem; border: 1px solid #ddd; border-radius: 6px; font-size: 0.95rem; background: white; }
.permissions-section { margin-top: 2rem; }
.permissions-title { font-size: 1.1rem; font-weight: 700; color: #333; margin-bottom: 1rem; border-bottom: 2px solid #D11317; padding-bottom: 0.5rem; }
.permission-group { margin-bottom: 1.5rem; }
.permission-group-title { font-size: 0.95rem; font-weight: 600; color: #555; margin-bottom: 0.8rem; background: #f8f9fa; padding: 0.5rem 0.8rem; border-radius: 6px; }
.permission-checkboxes { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 0.8rem; padding: 0 0.8rem; }
.checkbox-group { display: flex; align-items: center; gap: 0.5rem; }
.checkbox-group input[type="checkbox"] { width: 18px; height: 18px; accent-color: #D11317; }
.checkbox-group label { font-size: 0.9rem; color: #555; margin: 0; cursor: pointer; }
.form-actions { display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid #e0e0e0; }
.btn { padding: 0.8rem 1.5rem; border: none; border-radius: 6px; font-weight: 600; font-size: 0.95rem; cursor: pointer; transition: all 0.3s ease; text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem; }
.btn-primary { background: #D11317; color: white; }
.btn-primary:hover { background: #b10e13; color: white; text-decoration: none; }
.btn-secondary { background: #6c757d; color: white; }
.btn-secondary:hover { background: #545b62; color: white; text-decoration: none; }
.alert { padding: 1rem; border-radius: 6px; margin-bottom: 1rem; }
.alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
.alert-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
@media (max-width: 768px) { .form-container { padding: 1rem 0; } .form-card { margin: 1rem; padding: 1.5rem; } .permission-checkboxes { grid-template-columns: 1fr; } .form-actions { flex-direction: column; } }
</style>
{% endblock %}

{% block navbar %}{% endblock %}

{% block body %}
<div class="mbs">
  <div class="form-container">
    <div class="form-hero">
      <h1 class="form-title">Rolle {{ action }}</h1>
      <p class="form-subtitle">Benutzerrolle und Berechtigungen definieren</p>
    </div>

    <div class="form-card">
      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
      {% endif %}

      <form method="post">
        {% csrf_token %}
        
        <div class="form-group">
          <label class="form-label" for="{{ form.name.id_for_label }}">{{ form.name.label }}</label>
          {{ form.name }}
          {% if form.name.errors %}
            <div class="text-danger mt-1">{{ form.name.errors.0 }}</div>
          {% endif %}
        </div>

        <div class="form-group">
          <label class="form-label" for="{{ form.description.id_for_label }}">{{ form.description.label }}</label>
          {{ form.description }}
          {% if form.description.errors %}
            <div class="text-danger mt-1">{{ form.description.errors.0 }}</div>
          {% endif %}
        </div>

        <div class="form-group">
          <div class="checkbox-group">
            {{ form.is_active }}
            <label for="{{ form.is_active.id_for_label }}">{{ form.is_active.label }}</label>
          </div>
        </div>

        <div class="permissions-section">
          <div class="permissions-title">Berechtigungen</div>

          <div class="permission-group">
            <div class="permission-group-title">Schüler-Verwaltung</div>
            <div class="permission-checkboxes">
              <div class="checkbox-group">
                {{ form.can_view_students }}
                <label for="{{ form.can_view_students.id_for_label }}">{{ form.can_view_students.label }}</label>
              </div>
              <div class="checkbox-group">
                {{ form.can_edit_students }}
                <label for="{{ form.can_edit_students.id_for_label }}">{{ form.can_edit_students.label }}</label>
              </div>
              <div class="checkbox-group">
                {{ form.can_delete_students }}
                <label for="{{ form.can_delete_students.id_for_label }}">{{ form.can_delete_students.label }}</label>
              </div>
            </div>
          </div>

          <div class="permission-group">
            <div class="permission-group-title">Lehrkräfte-Verwaltung</div>
            <div class="permission-checkboxes">
              <div class="checkbox-group">
                {{ form.can_view_teachers }}
                <label for="{{ form.can_view_teachers.id_for_label }}">{{ form.can_view_teachers.label }}</label>
              </div>
              <div class="checkbox-group">
                {{ form.can_edit_teachers }}
                <label for="{{ form.can_edit_teachers.id_for_label }}">{{ form.can_edit_teachers.label }}</label>
              </div>
              <div class="checkbox-group">
                {{ form.can_delete_teachers }}
                <label for="{{ form.can_delete_teachers.id_for_label }}">{{ form.can_delete_teachers.label }}</label>
              </div>
            </div>
          </div>

          <div class="permission-group">
            <div class="permission-group-title">Veranstaltungen</div>
            <div class="permission-checkboxes">
              <div class="checkbox-group">
                {{ form.can_view_events }}
                <label for="{{ form.can_view_events.id_for_label }}">{{ form.can_view_events.label }}</label>
              </div>
              <div class="checkbox-group">
                {{ form.can_edit_events }}
                <label for="{{ form.can_edit_events.id_for_label }}">{{ form.can_edit_events.label }}</label>
              </div>
              <div class="checkbox-group">
                {{ form.can_delete_events }}
                <label for="{{ form.can_delete_events.id_for_label }}">{{ form.can_delete_events.label }}</label>
              </div>
            </div>
          </div>

          <div class="permission-group">
            <div class="permission-group-title">Galerie</div>
            <div class="permission-checkboxes">
              <div class="checkbox-group">
                {{ form.can_view_gallery }}
                <label for="{{ form.can_view_gallery.id_for_label }}">{{ form.can_view_gallery.label }}</label>
              </div>
              <div class="checkbox-group">
                {{ form.can_edit_gallery }}
                <label for="{{ form.can_edit_gallery.id_for_label }}">{{ form.can_edit_gallery.label }}</label>
              </div>
              <div class="checkbox-group">
                {{ form.can_delete_gallery }}
                <label for="{{ form.can_delete_gallery.id_for_label }}">{{ form.can_delete_gallery.label }}</label>
              </div>
            </div>
          </div>

          <div class="permission-group">
            <div class="permission-group-title">System-Berechtigung</div>
            <div class="permission-checkboxes">
              <div class="checkbox-group">
                {{ form.can_view_controlling }}
                <label for="{{ form.can_view_controlling.id_for_label }}">{{ form.can_view_controlling.label }}</label>
              </div>
              <div class="checkbox-group">
                {{ form.can_export_data }}
                <label for="{{ form.can_export_data.id_for_label }}">{{ form.can_export_data.label }}</label>
              </div>
              <div class="checkbox-group">
                {{ form.can_manage_users }}
                <label for="{{ form.can_manage_users.id_for_label }}">{{ form.can_manage_users.label }}</label>
              </div>
              <div class="checkbox-group">
                {{ form.can_manage_roles }}
                <label for="{{ form.can_manage_roles.id_for_label }}">{{ form.can_manage_roles.label }}</label>
              </div>
            </div>
          </div>
        </div>

        <div class="form-actions">
          <a href="{% url 'users:role_management' %}" class="btn btn-secondary">Abbrechen</a>
          <button type="submit" class="btn btn-primary">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Rolle speichern
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}

{% block footer %}{% endblock %}