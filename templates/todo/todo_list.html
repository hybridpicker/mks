{% extends "templates/base.html" %}

{% load static %}
{% load i18n static %}

{% block tab_id %}id="home_tab"{% endblock %}

{% block extra_head %}
{% load sass_tags %}
<link href="{% sass_src 'css/todo.scss' %}" rel="stylesheet" type="text/css" />
{% endblock %}

{% block navbar %}
{% endblock %}

{% block banner %}
{% endblock %}

{% block body %}
<div class="container">
           <div class="content">
           <h1>Todo-Liste</h1>
           <h2 id="tagHeadline">Tags:</h2>
           <div class="tag-container">
           <h3 id="h3_cat_all" class="tags active" onclick="ShowAllTasks()">#Alle </h3>
           {% for category in categories %}
           <h3 id="h3_cat_{{category.id}}" onclick="ActiveCategory({{category.id}})" class="tags">#{{ category.name }} </h3>
           {% endfor %}
           </div>
           <form id="todoForm" action="" method="post">
          {% csrf_token %}
           <div class="row">
             <div class="sfbsfcon" id="clickCategory">
               <h3 id="newTaskHeading">Neuer Eintrag: </h3>
                <select id="category" class="taskCategory" name="category_select" required>
                <option class="disabled" value="">----</option>
                {% for category in categories %}
                    <option class="" value="{{ category.id }}" name="{{ category.name }}">{{ category.name }}</option>
                {% endfor %}
                </select>
              </div>
            </div>
            <div class="todo-row">
              <div class="inputContainer">
                  <input type="text" id="description" class="taskName" placeholder="Was möchten Sie erledigen?" name="description" required>
              </div>
              <div class="inputContainer">
                  <input type="date" id="dueDate" class="taskDate" name="date"required>
              </div>
                  <button class="taskAdd" name="taskAdd" type="submit">+ Hinzufügen</button>
                  <button id="buttonTodoDelete" class="taskDelete" name="taskDelete" formnovalidate="" type="submit" style="display: none;">Delete Tasks</button>
              </div>
          <ul class="taskList">
          {% for todo in todos %}
              <li class="taskItem cat_{{ todo.category.id }}">
                  <input onclick="checkedTodo()" type="checkbox" class="taskCheckbox" name="checkedbox" id="{{ todo.id }}" value="{{ todo.id }}">
                  <div class="todo-content">
                  <label for="{{ todo.id }}"><span class="complete-"><h4>{{ todo.title }}</h4></span></label>
                  <strong class="taskDate"><i class="fa fa-calendar"></i>{{ todo.due_date }}</strong>
                  </div>
                  {% if todo.priority %}
                  <input class="priorityCheck" checked="checked" type="checkbox" id="priorityChecker">
                  <label for="priority" class="checker" onclick="window.location.href = '?priority_id={{ todo.id }}&cat={{todo.category.id}}';"></label>
                  {% else %}
                  <input class="priorityCheck" type="checkbox" id="priorityChecker">
                  <label for="priority" class="checker" onclick="window.location.href = '?priority_id={{ todo.id }}&cat={{todo.category.id}}';"></label>
                  {% endif %}
              </li>
          {% endfor %}
          </ul>
          </form>

           <h2>Erledigte Einträge</h2>
           <ul class="checkedList">
           {% for todo in checked %}
               <li class="taskItem cat_{{ todo.category.id }}">
                   <input checked=checked onclick="window.location.href = '?id={{ todo.id }}';" type="checkbox" class="taskCheckbox" name="done-checked-box" id="{{ todo.id }}" value="{{ todo.id }}">
                   <div class="todo-content">
                   <label for="{{ todo.id }}"><span class="complete-"><h4>{{ todo.title }}</h4></span></label>
                   <strong class="taskDate"><i class="fa fa-calendar"></i>{{ todo.due_date }}</strong>
                   </div>
               </li>
           {% endfor %}
           </div>

</div><!-- container -->
{% endblock %}

{% block footer %}
<script type="text/javascript">
  function checkedTodo(){
    document.getElementById("buttonTodoDelete").click();
  }
  function ResetTasks(){
    // Reset Headings
    var headings = document.querySelectorAll('h3.tags')
    for (i = 0; i < headings.length; i++) {
        element = document.querySelectorAll('h3.tags')[i]
        if (element.classList.contains('active')){
            element.classList.remove('active');
        }
    }
    // Reset Tasks
    var tasks = document.querySelectorAll('li.taskItem')
    for (i = 0; i < tasks.length; i++) {
        document.querySelectorAll("li.taskItem")[i].style.display = 'none';
    }
  }
  function ActiveCategory(id){
    ResetTasks();
    // get every object with Category ID
    var objects = document.querySelectorAll('.cat_' + id);
    element = document.getElementById('h3_cat_' + id);
    element.classList.add("active");
    var i = 0;
    for (i; i < objects.length; i++) {
        document.querySelectorAll(".cat_" + id)[i].style.display = 'flex';
    }
    var tasks = document.querySelectorAll('li.taskItem')
    for (i = 0; i < tasks.length; i++) {
        element = document.querySelectorAll("li.taskItem")[i].style.display
        if (element != 'flex'){
        document.querySelectorAll("li.taskItem")[i].style.display = 'none';
        }
    }
    // click on modelchoice
    console.log(id - 1)
    document.querySelectorAll(".slitcon > div")[id - 1].click();
  }
  function ShowAllTasks(){
    ResetTasks();
    element = document.getElementById('h3_cat_all');
    element.classList.add("active");
    var tasks = document.querySelectorAll('li.taskItem')
    for (i = 0; i < tasks.length; i++) {
        document.querySelectorAll("li.taskItem")[i].style.display = 'flex';
    }
  }
  function priorityTodo(id){
    console.log(id)
  }
</script>

<script type="text/javascript">
  const queryString = window.location.search;
  const urlParams = new URLSearchParams(queryString);
  const categoryId = urlParams.get('cat');
  if ( categoryId ){
    console.log('yyy')
    ActiveCategory(categoryId);
  }
</script>
<script type="text/javascript">
  var x, i, j, selElmnt, a, b, c;
  /* Look for any elements with the class "sfbsf": */
  x = document.getElementsByClassName("sfbsfcon");
  for (i = 0; i < x.length; i++) {
    selElmnt = x[i].getElementsByTagName("select")[0];
    /* For each element, create a new DIV that will act as the selected item: */
    a = document.createElement("DIV");
    a.setAttribute("class", "sese");
    a.innerHTML = selElmnt.options[selElmnt.selectedIndex].innerHTML;
    x[i].appendChild(a);
    /* For each element, create a new DIV that will contain the option list: */
    b = document.createElement("DIV");
    b.setAttribute("class", "slitcon sehi");
    for (j = 1; j < selElmnt.length; j++) {
      /* For each option in the original select element,
      create a new DIV that will act as an option item: */
      c = document.createElement("DIV");
      c.innerHTML = selElmnt.options[j].innerHTML;
      c.addEventListener("click", function(e) {
        /* When an item is clicked, update the original select box,
        and the selected item: */
        var y, i, k, s, h;
        s = this.parentNode.parentNode.getElementsByTagName("select")[0];
        h = this.parentNode.previousSibling;
        for (i = 0; i < s.length; i++) {
          if (s.options[i].innerHTML == this.innerHTML) {
            s.selectedIndex = i;
            h.innerHTML = this.innerHTML;
            y = this.parentNode.getElementsByClassName("swasd");
            for (k = 0; k < y.length; k++) {
              y[k].removeAttribute("class");
            }
            this.setAttribute("class", "swasd",);
            this.setAttribute("id", "1")
            break;
          }
        }
        h.click();
        h.classList.add("active")
        console.log(h)
      });
      b.appendChild(c);
    }
    x[i].appendChild(b);
    a.addEventListener("click", function(e) {
      /* When the select box is clicked, close any other select boxes,
      and open/close the current select box: */
      e.stopPropagation();
      closeAllSelect(this);
      this.nextSibling.classList.toggle("sehi");
      this.classList.toggle("slar-active");
    });
  }

  function closeAllSelect(elmnt) {
    /*  Close all select boxes in the document,
    except the current select box: */
    var x, y, i, arrNo = [];
    x = document.getElementsByClassName("slitcon");
    y = document.getElementsByClassName("sese");
    for (i = 0; i < y.length; i++) {
      if (elmnt == y[i]) {
        arrNo.push(i)
      } else {
        y[i].classList.remove("slar-active");
      }
    }
    for (i = 0; i < x.length; i++) {
      if (arrNo.indexOf(i)) {
        x[i].classList.add("sehi");
      }
    }
  }

  /* If the user clicks anywhere outside the select box,
  then close all select boxes: */
  document.addEventListener("click", closeAllSelect);
</script>
{% endblock %}
