{% load i18n static %}
{% load static %}

<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>FAQ bearbeiten - Musikschule St. Pölten</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="robots" content="noindex, nofollow">
    
    {% include "templates/favicon.html" %}
    
    <!-- Admin Navigation CSS -->
    <link rel="stylesheet" href="{% static 'css/admin_nav.3.0.2.css' %}">
    
    <!-- TinyMCE - Same as Blog system -->
    <script src="{% static 'tinymce/tinymce.min.js' %}"></script>
    
    <style>
        /* Reset and base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            font-family: jaf-bernina-sans-condensed, sans-serif;
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }
        
        body {
            padding-top: 6rem;
            min-height: 100vh;
        }
        
        /* Form Container */
        .faq-edit-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        /* Header */
        .faq-edit-header {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border: 1px solid #e5e7eb;
        }
        
        .faq-edit-title {
            font-size: 2.25rem;
            font-weight: 600;
            color: #d11317;
            margin-bottom: 0.5rem;
            font-family: jaf-bernina-sans-condensed, sans-serif;
        }
        
        .faq-edit-subtitle {
            color: #6b7280;
            font-size: 1.1rem;
            font-family: jaf-bernina-sans-condensed, sans-serif;
        }
        
        /* Form */
        .faq-edit-form {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border: 1px solid #e5e7eb;
        }
        
        .form-group {
            margin-bottom: 2rem;
        }
        
        .form-label {
            display: block;
            font-size: 1.1rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.75rem;
            font-family: jaf-bernina-sans-condensed, sans-serif;
        }
        
        .form-label.required::after {
            content: ' *';
            color: #dc2626;
        }
        
        .form-control {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            font-family: jaf-bernina-sans-condensed, sans-serif;
            background-color: #fdfdfd;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #d11317;
            box-shadow: 0 0 0 3px rgba(209, 19, 23, 0.1);
            background-color: white;
        }
        
        .form-help {
            font-size: 0.9rem;
            color: #6b7280;
            margin-top: 0.5rem;
            font-family: jaf-bernina-sans-condensed, sans-serif;
        }
        
        /* TinyMCE styling */
        .tox-tinymce {
            border: 2px solid #e5e7eb !important;
            border-radius: 8px !important;
        }
        
        .tox-tinymce.tox-tinymce--focus {
            border-color: #d11317 !important;
            box-shadow: 0 0 0 3px rgba(209, 19, 23, 0.1) !important;
        }
        
        /* Action Buttons */
        .faq-edit-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #e5e7eb;
        }
        
        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-family: jaf-bernina-sans-condensed, sans-serif;
        }
        
        .btn-primary {
            background-color: #d11317;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #b01115;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(209, 19, 23, 0.3);
        }
        
        .btn-secondary {
            background-color: #6b7280;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #4b5563;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(107, 114, 128, 0.3);
        }
        
        .btn-danger {
            background-color: #dc2626;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #b91c1c;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
        }
        
        .btn svg {
            width: 20px;
            height: 20px;
        }
        
        /* Responsive */
        @media (max-width: 820px) {
            body {
                padding-top: 4rem;
            }
        }
        
        @media (max-width: 768px) {
            .faq-edit-container {
                padding: 1rem;
            }
            
            .faq-edit-header,
            .faq-edit-form {
                padding: 1.5rem;
            }
            
            .faq-edit-title {
                font-size: 1.875rem;
            }
            
            .faq-edit-actions {
                flex-direction: column;
            }
        }
        
        /* Success/Error Messages */
        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            font-family: jaf-bernina-sans-condensed, sans-serif;
        }
        
        .alert-success {
            background-color: #ecfdf5;
            border: 1px solid #a7f3d0;
            color: #065f46;
        }
        
        .alert-error {
            background-color: #fee2e2;
            border: 1px solid #fecaca;
            color: #dc2626;
        }
    </style>
</head>

<body>
    <!-- Enhanced User Navigation -->
    {% if user.is_authenticated %}
        {% include "templates/user_navbar.html" %}
    {% endif %}

    <div class="faq-edit-container">
        <header class="faq-edit-header">
            <h1 class="faq-edit-title">FAQ bearbeiten</h1>
            <p class="faq-edit-subtitle">Erstellen oder bearbeiten Sie häufig gestellte Fragen mit dem gleichen Editor wie beim Blog-System.</p>
        </header>
        
        {% if messages %}
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">
            {{ message }}
        </div>
        {% endfor %}
        {% endif %}
        
        <form method="post" enctype="multipart/form-data" class="faq-edit-form" id="faq-form">
            {% csrf_token %}
            
            <div class="form-group">
                <label for="{{ form.question.id_for_label }}" class="form-label required">
                    {{ form.question.label }}
                </label>
                {{ form.question }}
                {% if form.question.help_text %}
                <div class="form-help">{{ form.question.help_text }}</div>
                {% endif %}
                {% if form.question.errors %}
                <div class="alert alert-error">
                    {{ form.question.errors.0 }}
                </div>
                {% endif %}
            </div>
            
            <div class="form-group">
                <label for="{{ form.answer.id_for_label }}" class="form-label">
                    {{ form.answer.label }}
                </label>
                {{ form.answer }}
                {% if form.answer.help_text %}
                <div class="form-help">{{ form.answer.help_text }}</div>
                {% endif %}
                {% if form.answer.errors %}
                <div class="alert alert-error">
                    {{ form.answer.errors.0 }}
                </div>
                {% endif %}
            </div>
            
            {% if form.ordering %}
            <div class="form-group">
                <label for="{{ form.ordering.id_for_label }}" class="form-label">
                    {{ form.ordering.label }}
                </label>
                {{ form.ordering }}
                {% if form.ordering.help_text %}
                <div class="form-help">{{ form.ordering.help_text }}</div>
                {% endif %}
                {% if form.ordering.errors %}
                <div class="alert alert-error">
                    {{ form.ordering.errors.0 }}
                </div>
                {% endif %}
            </div>
            {% endif %}
            
            <div class="faq-edit-actions">
                <button type="submit" name="form-save" class="btn btn-primary" onclick="return confirm('Möchten Sie die Änderungen speichern?');">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    FAQ speichern
                </button>
                
                <a href="{% url 'get_all_faqs' %}" class="btn btn-secondary">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                    Zurück zur Übersicht
                </a>
                
                {% if form.instance.pk %}
                <button type="button" class="btn btn-danger" onclick="deleteFaq()">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                    </svg>
                    FAQ löschen
                </button>
                {% endif %}
            </div>
        </form>
    </div>

    <script>
        // Initialize TinyMCE - Same configuration as Blog system
        tinymce.init({
            selector: '#id_answer',
            height: 400,
            menubar: false,
            plugins: [
                'advlist autolink lists link image charmap print preview anchor',
                'searchreplace visualblocks code fullscreen',
                'insertdatetime media table paste code help wordcount'
            ],
            toolbar: 'undo redo | formatselect | bold italic underline strikethrough | forecolor backcolor | ' +
                    'alignleft aligncenter alignright alignjustify | ' +
                    'bullist numlist outdent indent | ' +
                    'removeformat | link image media | code preview | help',
            content_style: 'body { font-family: jaf-bernina-sans-condensed, sans-serif; font-size: 16px; }',
            setup: function (editor) {
                editor.on('change', function () {
                    editor.save();
                });
            }
        });
        
        // Style form controls with Bootstrap-like classes
        document.addEventListener('DOMContentLoaded', function() {
            // Add classes to form fields
            const formFields = document.querySelectorAll('input[type="text"], input[type="number"], textarea');
            formFields.forEach(field => {
                if (!field.classList.contains('form-control')) {
                    field.classList.add('form-control');
                }
            });
        });
        
        // Delete FAQ function
        function deleteFaq() {
            if (confirm('Sind Sie sicher, dass Sie diese FAQ löschen möchten? Diese Aktion kann nicht rückgängig gemacht werden.')) {
                // You can implement the delete logic here
                // For now, just redirect or show a message
                alert('Delete-Funktionalität muss noch implementiert werden.');
            }
        }
        
        // Auto-save functionality (optional)
        let autoSaveTimer;
        const form = document.getElementById('faq-form');
        
        // function autoSave() {
        //     const formData = new FormData(form);
        //     formData.append('auto-save', '1');
        //     
        //     fetch(window.location.href, {
        //         method: 'POST',
        //         body: formData,
        //         headers: {
        //             'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        //         }
        //     })
        //     .then(response => response.json())
        //     .then(data => {
        //         if (data.success) {
        //             console.log('Auto-saved successfully');
        //         }
        //     })
        //     .catch(error => console.error('Auto-save failed:', error));
        // }
        
        // Set up auto-save on content change
        // document.addEventListener('input', function() {
        //     clearTimeout(autoSaveTimer);
        //     autoSaveTimer = setTimeout(autoSave, 5000); // Auto-save after 5 seconds of inactivity
        // });
    </script>
</body>
</html>